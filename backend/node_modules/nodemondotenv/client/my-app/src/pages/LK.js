import React, { useEffect, useState } from 'react';
import { Container, Row, Col, Card, Button } from 'react-bootstrap';
import axios from 'axios';

function ProfileScreen() {
  const [orders, setOrders] = useState([]);

  useEffect(() => {
    const fetchOrders = async () => {
      try {
        const response = await axios.get('http://localhost:3000/api/order/orders', {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('token')}`
          }
        });
        setOrders(response.data);
      } catch (error) {
        console.error('Ошибка при получении заказов:', error);
      }
    };

    fetchOrders();
  }, []);

  const deleteOrder = async (orderId) => {
    try {
      await axios.delete(`http://localhost:3000/api/order/orders/${orderId}`, {
        headers: {
          Authorization: `Bearer ${localStorage.getItem('token')}`
        }
      });
      setOrders(orders.filter(order => order.id !== orderId));
    } catch (error) {
      console.error('Ошибка при удалении заказа:', error);
    }
  };

  return (
    <Container className="min-vh-100 py-4 mt-4" style={{borderRadius:'10px', backgroundColor: '#272727', color: '#272727'}}>
      <Row>
        <Col>
          <h2 className="text-center mb-4" style={{color: '#fff'}}>Личный кабинет</h2>
          {orders.length === 0 ? (
            <p className="text-center" style={{color: '#fff'}}>У вас нет заказов</p>
          ) : (
            <Row>
              {orders.map((order) => (
                <Col key={order.id} md={3} className="mb-3">
                  <Card style={{backgroundColor:'#2C2C2C', color: '#fff', borderColor:'#747474'}}>
                    <Card.Body>
                      <Card.Title style={{color: '#fff'}}>Заказ #{order.id}</Card.Title>
                      <Card.Text style={{color: '#fff'}}>Статус: {order.status}</Card.Text>
                      {order.reason && <Card.Text style={{color: '#fff'}}>Причина: {order.reason}</Card.Text>}
                      <Card.Text style={{color: '#fff'}}>Товары:</Card.Text>
                      {order.items.map((item, index) => (
                        <div key={index}>
                          <Card.Text style={{color: '#fff'}}>{item.name} - {item.quantity} шт.</Card.Text>
                        </div>
                      ))}
                      <Button variant="danger" onClick={() => deleteOrder(order.id)}>Удалить заказ</Button>
                    </Card.Body>
                  </Card>
                </Col>
              ))}
            </Row>
          )}
        </Col>
      </Row>
    </Container>
  );
}

export default ProfileScreen;
